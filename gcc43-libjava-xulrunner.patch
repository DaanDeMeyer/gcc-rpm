--- libjava/classpath/configure.ac.jj	2007-09-05 21:38:54.000000000 +0200
+++ libjava/classpath/configure.ac	2007-12-20 23:49:43.000000000 +0100
@@ -619,7 +619,7 @@ if test "x${COMPILE_JNI}" = xyes; then
 
   dnl Check for AWT related Qt4
   if test "x${COMPILE_QT_PEER}" = xyes; then
-    PKG_CHECK_MODULES(QT, QtCore QtGui >= 4.1.0, HAVE_QT4="yes", HAVE_QT4="no")
+    PKG_CHECK_MODULES(QT, QtCore QtGui >= 4.1.0, , HAVE_QT4="yes", HAVE_QT4="no")
     if test "x$HAVE_QT4" = "xyes"; then
       dnl Check needed because in some cases the QtGui includedir
       dnl doesn't contain the subsystem dir.
@@ -702,21 +702,24 @@ if test "x${COMPILE_JNI}" = xyes; then
 
   dnl Check for plugin support headers and libraries.
   if test "x${COMPILE_PLUGIN}" = xyes; then
-    PKG_CHECK_MODULES(MOZILLA, mozilla-plugin, [MOZILLA_FOUND=yes], [MOZILLA_FOUND=no])
+    PKG_CHECK_MODULES(MOZILLA, mozilla-plugin mozilla-xpcom, --define-variable=includetype=unstable, [MOZILLA_FOUND=yes], [MOZILLA_FOUND=no])
     if test "x${MOZILLA_FOUND}" = xno; then
-      PKG_CHECK_MODULES(MOZILLA, firefox-plugin firefox-xpcom, [MOZILLA_FOUND=yes], [MOZILLA_FOUND=no])
+      PKG_CHECK_MODULES(MOZILLA, mozilla-plugin, , [MOZILLA_FOUND=yes], [MOZILLA_FOUND=no])
     fi
     if test "x${MOZILLA_FOUND}" = xno; then
-      PKG_CHECK_MODULES(MOZILLA, xulrunner-plugin xulrunner-xpcom, [MOZILLA_FOUND=yes], [MOZILLA_FOUND=no])
+      PKG_CHECK_MODULES(MOZILLA, firefox-plugin firefox-xpcom, , [MOZILLA_FOUND=yes], [MOZILLA_FOUND=no])
     fi
     if test "x${MOZILLA_FOUND}" = xno; then
-      PKG_CHECK_MODULES(MOZILLA, mozilla-firefox-plugin mozilla-firefox-xpcom, [MOZILLA_FOUND=yes], [MOZILLA_FOUND=no])
+      PKG_CHECK_MODULES(MOZILLA, xulrunner-plugin xulrunner-xpcom, --define-variable=includetype=unstable, [MOZILLA_FOUND=yes], [MOZILLA_FOUND=no])
     fi
     if test "x${MOZILLA_FOUND}" = xno; then
-      PKG_CHECK_MODULES(MOZILLA, seamonkey-plugin seamonkey-xpcom, [MOZILLA_FOUND=yes], [MOZILLA_FOUND=no])
+      PKG_CHECK_MODULES(MOZILLA, mozilla-firefox-plugin mozilla-firefox-xpcom, , [MOZILLA_FOUND=yes], [MOZILLA_FOUND=no])
     fi
     if test "x${MOZILLA_FOUND}" = xno; then
-      PKG_CHECK_MODULES(MOZILLA, iceape-plugin iceape-xpcom, [MOZILLA_FOUND=yes], [MOZILLA_FOUND=no])
+      PKG_CHECK_MODULES(MOZILLA, seamonkey-plugin seamonkey-xpcom, , [MOZILLA_FOUND=yes], [MOZILLA_FOUND=no])
+    fi
+    if test "x${MOZILLA_FOUND}" = xno; then
+      PKG_CHECK_MODULES(MOZILLA, iceape-plugin iceape-xpcom, , [MOZILLA_FOUND=yes], [MOZILLA_FOUND=no])
     fi
     if test "x${MOZILLA_FOUND}" = xno; then
       AC_MSG_ERROR([Couldn't find plugin support headers and libraries, try --disable-plugin])
--- libjava/classpath/configure.jj	2007-09-05 21:38:54.000000000 +0200
+++ libjava/classpath/configure	2007-12-20 23:49:54.000000000 +0100
@@ -19611,13 +19611,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking XML_CFLAGS" >&5
 echo $ECHO_N "checking XML_CFLAGS... $ECHO_C" >&6
-            XML_CFLAGS=`$PKG_CONFIG --cflags "libxml-2.0 >= 2.6.8"`
+            XML_CFLAGS=`$PKG_CONFIG --cflags  "libxml-2.0 >= 2.6.8"`
             echo "$as_me:$LINENO: result: $XML_CFLAGS" >&5
 echo "${ECHO_T}$XML_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking XML_LIBS" >&5
 echo $ECHO_N "checking XML_LIBS... $ECHO_C" >&6
-            XML_LIBS=`$PKG_CONFIG --libs "libxml-2.0 >= 2.6.8"`
+            XML_LIBS=`$PKG_CONFIG --libs  "libxml-2.0 >= 2.6.8"`
             echo "$as_me:$LINENO: result: $XML_LIBS" >&5
 echo "${ECHO_T}$XML_LIBS" >&6
         else
@@ -19709,13 +19709,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking XSLT_CFLAGS" >&5
 echo $ECHO_N "checking XSLT_CFLAGS... $ECHO_C" >&6
-            XSLT_CFLAGS=`$PKG_CONFIG --cflags "libxslt >= 1.1.11"`
+            XSLT_CFLAGS=`$PKG_CONFIG --cflags  "libxslt >= 1.1.11"`
             echo "$as_me:$LINENO: result: $XSLT_CFLAGS" >&5
 echo "${ECHO_T}$XSLT_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking XSLT_LIBS" >&5
 echo $ECHO_N "checking XSLT_LIBS... $ECHO_C" >&6
-            XSLT_LIBS=`$PKG_CONFIG --libs "libxslt >= 1.1.11"`
+            XSLT_LIBS=`$PKG_CONFIG --libs  "libxslt >= 1.1.11"`
             echo "$as_me:$LINENO: result: $XSLT_LIBS" >&5
 echo "${ECHO_T}$XSLT_LIBS" >&6
         else
@@ -21365,13 +21365,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking GTK_CFLAGS" >&5
 echo $ECHO_N "checking GTK_CFLAGS... $ECHO_C" >&6
-            GTK_CFLAGS=`$PKG_CONFIG --cflags "gtk+-2.0 >= 2.8 gthread-2.0 >= 2.2 gdk-pixbuf-2.0"`
+            GTK_CFLAGS=`$PKG_CONFIG --cflags  "gtk+-2.0 >= 2.8 gthread-2.0 >= 2.2 gdk-pixbuf-2.0"`
             echo "$as_me:$LINENO: result: $GTK_CFLAGS" >&5
 echo "${ECHO_T}$GTK_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking GTK_LIBS" >&5
 echo $ECHO_N "checking GTK_LIBS... $ECHO_C" >&6
-            GTK_LIBS=`$PKG_CONFIG --libs "gtk+-2.0 >= 2.8 gthread-2.0 >= 2.2 gdk-pixbuf-2.0"`
+            GTK_LIBS=`$PKG_CONFIG --libs  "gtk+-2.0 >= 2.8 gthread-2.0 >= 2.2 gdk-pixbuf-2.0"`
             echo "$as_me:$LINENO: result: $GTK_LIBS" >&5
 echo "${ECHO_T}$GTK_LIBS" >&6
         else
@@ -21463,13 +21463,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking FREETYPE2_CFLAGS" >&5
 echo $ECHO_N "checking FREETYPE2_CFLAGS... $ECHO_C" >&6
-            FREETYPE2_CFLAGS=`$PKG_CONFIG --cflags "freetype2"`
+            FREETYPE2_CFLAGS=`$PKG_CONFIG --cflags  "freetype2"`
             echo "$as_me:$LINENO: result: $FREETYPE2_CFLAGS" >&5
 echo "${ECHO_T}$FREETYPE2_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking FREETYPE2_LIBS" >&5
 echo $ECHO_N "checking FREETYPE2_LIBS... $ECHO_C" >&6
-            FREETYPE2_LIBS=`$PKG_CONFIG --libs "freetype2"`
+            FREETYPE2_LIBS=`$PKG_CONFIG --libs  "freetype2"`
             echo "$as_me:$LINENO: result: $FREETYPE2_LIBS" >&5
 echo "${ECHO_T}$FREETYPE2_LIBS" >&6
         else
@@ -21561,13 +21561,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking PANGOFT2_CFLAGS" >&5
 echo $ECHO_N "checking PANGOFT2_CFLAGS... $ECHO_C" >&6
-            PANGOFT2_CFLAGS=`$PKG_CONFIG --cflags "pangoft2"`
+            PANGOFT2_CFLAGS=`$PKG_CONFIG --cflags  "pangoft2"`
             echo "$as_me:$LINENO: result: $PANGOFT2_CFLAGS" >&5
 echo "${ECHO_T}$PANGOFT2_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking PANGOFT2_LIBS" >&5
 echo $ECHO_N "checking PANGOFT2_LIBS... $ECHO_C" >&6
-            PANGOFT2_LIBS=`$PKG_CONFIG --libs "pangoft2"`
+            PANGOFT2_LIBS=`$PKG_CONFIG --libs  "pangoft2"`
             echo "$as_me:$LINENO: result: $PANGOFT2_LIBS" >&5
 echo "${ECHO_T}$PANGOFT2_LIBS" >&6
         else
@@ -21659,13 +21659,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking CAIRO_CFLAGS" >&5
 echo $ECHO_N "checking CAIRO_CFLAGS... $ECHO_C" >&6
-            CAIRO_CFLAGS=`$PKG_CONFIG --cflags "cairo >= 1.1.8"`
+            CAIRO_CFLAGS=`$PKG_CONFIG --cflags  "cairo >= 1.1.8"`
             echo "$as_me:$LINENO: result: $CAIRO_CFLAGS" >&5
 echo "${ECHO_T}$CAIRO_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking CAIRO_LIBS" >&5
 echo $ECHO_N "checking CAIRO_LIBS... $ECHO_C" >&6
-            CAIRO_LIBS=`$PKG_CONFIG --libs "cairo >= 1.1.8"`
+            CAIRO_LIBS=`$PKG_CONFIG --libs  "cairo >= 1.1.8"`
             echo "$as_me:$LINENO: result: $CAIRO_LIBS" >&5
 echo "${ECHO_T}$CAIRO_LIBS" >&6
         else
@@ -21927,13 +21927,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking GCONF_CFLAGS" >&5
 echo $ECHO_N "checking GCONF_CFLAGS... $ECHO_C" >&6
-            GCONF_CFLAGS=`$PKG_CONFIG --cflags "gconf-2.0 >= 2.6.0"`
+            GCONF_CFLAGS=`$PKG_CONFIG --cflags  "gconf-2.0 >= 2.6.0"`
             echo "$as_me:$LINENO: result: $GCONF_CFLAGS" >&5
 echo "${ECHO_T}$GCONF_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking GCONF_LIBS" >&5
 echo $ECHO_N "checking GCONF_LIBS... $ECHO_C" >&6
-            GCONF_LIBS=`$PKG_CONFIG --libs "gconf-2.0 >= 2.6.0"`
+            GCONF_LIBS=`$PKG_CONFIG --libs  "gconf-2.0 >= 2.6.0"`
             echo "$as_me:$LINENO: result: $GCONF_LIBS" >&5
 echo "${ECHO_T}$GCONF_LIBS" >&6
         else
@@ -22027,13 +22027,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking GDK_CFLAGS" >&5
 echo $ECHO_N "checking GDK_CFLAGS... $ECHO_C" >&6
-            GDK_CFLAGS=`$PKG_CONFIG --cflags "gdk-2.0 >= 2.8"`
+            GDK_CFLAGS=`$PKG_CONFIG --cflags  "gdk-2.0 >= 2.8"`
             echo "$as_me:$LINENO: result: $GDK_CFLAGS" >&5
 echo "${ECHO_T}$GDK_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking GDK_LIBS" >&5
 echo $ECHO_N "checking GDK_LIBS... $ECHO_C" >&6
-            GDK_LIBS=`$PKG_CONFIG --libs "gdk-2.0 >= 2.8"`
+            GDK_LIBS=`$PKG_CONFIG --libs  "gdk-2.0 >= 2.8"`
             echo "$as_me:$LINENO: result: $GDK_LIBS" >&5
 echo "${ECHO_T}$GDK_LIBS" >&6
         else
@@ -22137,13 +22137,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking GSTREAMER_CFLAGS" >&5
 echo $ECHO_N "checking GSTREAMER_CFLAGS... $ECHO_C" >&6
-            GSTREAMER_CFLAGS=`$PKG_CONFIG --cflags "gstreamer-$GST_MAJORMINOR >= $GST_REQUIRED"`
+            GSTREAMER_CFLAGS=`$PKG_CONFIG --cflags  "gstreamer-$GST_MAJORMINOR >= $GST_REQUIRED"`
             echo "$as_me:$LINENO: result: $GSTREAMER_CFLAGS" >&5
 echo "${ECHO_T}$GSTREAMER_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking GSTREAMER_LIBS" >&5
 echo $ECHO_N "checking GSTREAMER_LIBS... $ECHO_C" >&6
-            GSTREAMER_LIBS=`$PKG_CONFIG --libs "gstreamer-$GST_MAJORMINOR >= $GST_REQUIRED"`
+            GSTREAMER_LIBS=`$PKG_CONFIG --libs  "gstreamer-$GST_MAJORMINOR >= $GST_REQUIRED"`
             echo "$as_me:$LINENO: result: $GSTREAMER_LIBS" >&5
 echo "${ECHO_T}$GSTREAMER_LIBS" >&6
         else
@@ -22238,13 +22238,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking GSTREAMER_BASE_CFLAGS" >&5
 echo $ECHO_N "checking GSTREAMER_BASE_CFLAGS... $ECHO_C" >&6
-            GSTREAMER_BASE_CFLAGS=`$PKG_CONFIG --cflags "gstreamer-base-$GST_MAJORMINOR >= $GST_REQUIRED"`
+            GSTREAMER_BASE_CFLAGS=`$PKG_CONFIG --cflags  "gstreamer-base-$GST_MAJORMINOR >= $GST_REQUIRED"`
             echo "$as_me:$LINENO: result: $GSTREAMER_BASE_CFLAGS" >&5
 echo "${ECHO_T}$GSTREAMER_BASE_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking GSTREAMER_BASE_LIBS" >&5
 echo $ECHO_N "checking GSTREAMER_BASE_LIBS... $ECHO_C" >&6
-            GSTREAMER_BASE_LIBS=`$PKG_CONFIG --libs "gstreamer-base-$GST_MAJORMINOR >= $GST_REQUIRED"`
+            GSTREAMER_BASE_LIBS=`$PKG_CONFIG --libs  "gstreamer-base-$GST_MAJORMINOR >= $GST_REQUIRED"`
             echo "$as_me:$LINENO: result: $GSTREAMER_BASE_LIBS" >&5
 echo "${ECHO_T}$GSTREAMER_BASE_LIBS" >&6
         else
@@ -22339,13 +22339,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking GSTREAMER_PLUGINS_BASE_CFLAGS" >&5
 echo $ECHO_N "checking GSTREAMER_PLUGINS_BASE_CFLAGS... $ECHO_C" >&6
-            GSTREAMER_PLUGINS_BASE_CFLAGS=`$PKG_CONFIG --cflags "gstreamer-plugins-base-$GST_MAJORMINOR >= $GST_REQUIRED"`
+            GSTREAMER_PLUGINS_BASE_CFLAGS=`$PKG_CONFIG --cflags  "gstreamer-plugins-base-$GST_MAJORMINOR >= $GST_REQUIRED"`
             echo "$as_me:$LINENO: result: $GSTREAMER_PLUGINS_BASE_CFLAGS" >&5
 echo "${ECHO_T}$GSTREAMER_PLUGINS_BASE_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking GSTREAMER_PLUGINS_BASE_LIBS" >&5
 echo $ECHO_N "checking GSTREAMER_PLUGINS_BASE_LIBS... $ECHO_C" >&6
-            GSTREAMER_PLUGINS_BASE_LIBS=`$PKG_CONFIG --libs "gstreamer-plugins-base-$GST_MAJORMINOR >= $GST_REQUIRED"`
+            GSTREAMER_PLUGINS_BASE_LIBS=`$PKG_CONFIG --libs  "gstreamer-plugins-base-$GST_MAJORMINOR >= $GST_REQUIRED"`
             echo "$as_me:$LINENO: result: $GSTREAMER_PLUGINS_BASE_LIBS" >&5
 echo "${ECHO_T}$GSTREAMER_PLUGINS_BASE_LIBS" >&6
         else
@@ -22450,13 +22450,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking QT_CFLAGS" >&5
 echo $ECHO_N "checking QT_CFLAGS... $ECHO_C" >&6
-            QT_CFLAGS=`$PKG_CONFIG --cflags "QtCore QtGui >= 4.1.0"`
+            QT_CFLAGS=`$PKG_CONFIG --cflags  "QtCore QtGui >= 4.1.0"`
             echo "$as_me:$LINENO: result: $QT_CFLAGS" >&5
 echo "${ECHO_T}$QT_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking QT_LIBS" >&5
 echo $ECHO_N "checking QT_LIBS... $ECHO_C" >&6
-            QT_LIBS=`$PKG_CONFIG --libs "QtCore QtGui >= 4.1.0"`
+            QT_LIBS=`$PKG_CONFIG --libs  "QtCore QtGui >= 4.1.0"`
             echo "$as_me:$LINENO: result: $QT_LIBS" >&5
 echo "${ECHO_T}$QT_LIBS" >&6
         else
@@ -22904,6 +22904,103 @@ fi
   else
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
+        echo "$as_me:$LINENO: checking for mozilla-plugin mozilla-xpcom" >&5
+echo $ECHO_N "checking for mozilla-plugin mozilla-xpcom... $ECHO_C" >&6
+
+        if $PKG_CONFIG --exists "mozilla-plugin mozilla-xpcom" ; then
+            echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
+            succeeded=yes
+
+            echo "$as_me:$LINENO: checking MOZILLA_CFLAGS" >&5
+echo $ECHO_N "checking MOZILLA_CFLAGS... $ECHO_C" >&6
+            MOZILLA_CFLAGS=`$PKG_CONFIG --cflags --define-variable=includetype=unstable "mozilla-plugin mozilla-xpcom"`
+            echo "$as_me:$LINENO: result: $MOZILLA_CFLAGS" >&5
+echo "${ECHO_T}$MOZILLA_CFLAGS" >&6
+
+            echo "$as_me:$LINENO: checking MOZILLA_LIBS" >&5
+echo $ECHO_N "checking MOZILLA_LIBS... $ECHO_C" >&6
+            MOZILLA_LIBS=`$PKG_CONFIG --libs --define-variable=includetype=unstable "mozilla-plugin mozilla-xpcom"`
+            echo "$as_me:$LINENO: result: $MOZILLA_LIBS" >&5
+echo "${ECHO_T}$MOZILLA_LIBS" >&6
+        else
+            MOZILLA_CFLAGS=""
+            MOZILLA_LIBS=""
+            ## If we have a custom action on failure, don't print errors, but
+            ## do set a variable so people can do so.
+            MOZILLA_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "mozilla-plugin mozilla-xpcom"`
+
+        fi
+
+
+
+     else
+        echo "*** Your version of pkg-config is too old. You need version $PKG_CONFIG_MIN_VERSION or newer."
+        echo "*** See http://www.freedesktop.org/software/pkgconfig"
+     fi
+  fi
+
+  if test $succeeded = yes; then
+     MOZILLA_FOUND=yes
+  else
+     MOZILLA_FOUND=no
+  fi
+
+    if test "x${MOZILLA_FOUND}" = xno; then
+
+  succeeded=no
+
+  if test -z "$PKG_CONFIG"; then
+    # Extract the first word of "pkg-config", so it can be a program name with args.
+set dummy pkg-config; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_path_PKG_CONFIG+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  case $PKG_CONFIG in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_PKG_CONFIG="$PKG_CONFIG" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+  test -z "$ac_cv_path_PKG_CONFIG" && ac_cv_path_PKG_CONFIG="no"
+  ;;
+esac
+fi
+PKG_CONFIG=$ac_cv_path_PKG_CONFIG
+
+if test -n "$PKG_CONFIG"; then
+  echo "$as_me:$LINENO: result: $PKG_CONFIG" >&5
+echo "${ECHO_T}$PKG_CONFIG" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+  fi
+
+  if test "$PKG_CONFIG" = "no" ; then
+     echo "*** The pkg-config script could not be found. Make sure it is"
+     echo "*** in your path, or set the PKG_CONFIG environment variable"
+     echo "*** to the full path to pkg-config."
+     echo "*** Or see http://www.freedesktop.org/software/pkgconfig to get pkg-config."
+  else
+     PKG_CONFIG_MIN_VERSION=0.9.0
+     if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo "$as_me:$LINENO: checking for mozilla-plugin" >&5
 echo $ECHO_N "checking for mozilla-plugin... $ECHO_C" >&6
 
@@ -22914,13 +23011,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking MOZILLA_CFLAGS" >&5
 echo $ECHO_N "checking MOZILLA_CFLAGS... $ECHO_C" >&6
-            MOZILLA_CFLAGS=`$PKG_CONFIG --cflags "mozilla-plugin"`
+            MOZILLA_CFLAGS=`$PKG_CONFIG --cflags  "mozilla-plugin"`
             echo "$as_me:$LINENO: result: $MOZILLA_CFLAGS" >&5
 echo "${ECHO_T}$MOZILLA_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking MOZILLA_LIBS" >&5
 echo $ECHO_N "checking MOZILLA_LIBS... $ECHO_C" >&6
-            MOZILLA_LIBS=`$PKG_CONFIG --libs "mozilla-plugin"`
+            MOZILLA_LIBS=`$PKG_CONFIG --libs  "mozilla-plugin"`
             echo "$as_me:$LINENO: result: $MOZILLA_LIBS" >&5
 echo "${ECHO_T}$MOZILLA_LIBS" >&6
         else
@@ -22946,6 +23043,7 @@ echo "${ECHO_T}$MOZILLA_LIBS" >&6
      MOZILLA_FOUND=no
   fi
 
+    fi
     if test "x${MOZILLA_FOUND}" = xno; then
 
   succeeded=no
@@ -23011,13 +23109,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking MOZILLA_CFLAGS" >&5
 echo $ECHO_N "checking MOZILLA_CFLAGS... $ECHO_C" >&6
-            MOZILLA_CFLAGS=`$PKG_CONFIG --cflags "firefox-plugin firefox-xpcom"`
+            MOZILLA_CFLAGS=`$PKG_CONFIG --cflags  "firefox-plugin firefox-xpcom"`
             echo "$as_me:$LINENO: result: $MOZILLA_CFLAGS" >&5
 echo "${ECHO_T}$MOZILLA_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking MOZILLA_LIBS" >&5
 echo $ECHO_N "checking MOZILLA_LIBS... $ECHO_C" >&6
-            MOZILLA_LIBS=`$PKG_CONFIG --libs "firefox-plugin firefox-xpcom"`
+            MOZILLA_LIBS=`$PKG_CONFIG --libs  "firefox-plugin firefox-xpcom"`
             echo "$as_me:$LINENO: result: $MOZILLA_LIBS" >&5
 echo "${ECHO_T}$MOZILLA_LIBS" >&6
         else
@@ -23109,13 +23207,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking MOZILLA_CFLAGS" >&5
 echo $ECHO_N "checking MOZILLA_CFLAGS... $ECHO_C" >&6
-            MOZILLA_CFLAGS=`$PKG_CONFIG --cflags "xulrunner-plugin xulrunner-xpcom"`
+            MOZILLA_CFLAGS=`$PKG_CONFIG --cflags --define-variable=includetype=unstable "xulrunner-plugin xulrunner-xpcom"`
             echo "$as_me:$LINENO: result: $MOZILLA_CFLAGS" >&5
 echo "${ECHO_T}$MOZILLA_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking MOZILLA_LIBS" >&5
 echo $ECHO_N "checking MOZILLA_LIBS... $ECHO_C" >&6
-            MOZILLA_LIBS=`$PKG_CONFIG --libs "xulrunner-plugin xulrunner-xpcom"`
+            MOZILLA_LIBS=`$PKG_CONFIG --libs --define-variable=includetype=unstable "xulrunner-plugin xulrunner-xpcom"`
             echo "$as_me:$LINENO: result: $MOZILLA_LIBS" >&5
 echo "${ECHO_T}$MOZILLA_LIBS" >&6
         else
@@ -23207,13 +23305,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking MOZILLA_CFLAGS" >&5
 echo $ECHO_N "checking MOZILLA_CFLAGS... $ECHO_C" >&6
-            MOZILLA_CFLAGS=`$PKG_CONFIG --cflags "mozilla-firefox-plugin mozilla-firefox-xpcom"`
+            MOZILLA_CFLAGS=`$PKG_CONFIG --cflags  "mozilla-firefox-plugin mozilla-firefox-xpcom"`
             echo "$as_me:$LINENO: result: $MOZILLA_CFLAGS" >&5
 echo "${ECHO_T}$MOZILLA_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking MOZILLA_LIBS" >&5
 echo $ECHO_N "checking MOZILLA_LIBS... $ECHO_C" >&6
-            MOZILLA_LIBS=`$PKG_CONFIG --libs "mozilla-firefox-plugin mozilla-firefox-xpcom"`
+            MOZILLA_LIBS=`$PKG_CONFIG --libs  "mozilla-firefox-plugin mozilla-firefox-xpcom"`
             echo "$as_me:$LINENO: result: $MOZILLA_LIBS" >&5
 echo "${ECHO_T}$MOZILLA_LIBS" >&6
         else
@@ -23305,13 +23403,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking MOZILLA_CFLAGS" >&5
 echo $ECHO_N "checking MOZILLA_CFLAGS... $ECHO_C" >&6
-            MOZILLA_CFLAGS=`$PKG_CONFIG --cflags "seamonkey-plugin seamonkey-xpcom"`
+            MOZILLA_CFLAGS=`$PKG_CONFIG --cflags  "seamonkey-plugin seamonkey-xpcom"`
             echo "$as_me:$LINENO: result: $MOZILLA_CFLAGS" >&5
 echo "${ECHO_T}$MOZILLA_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking MOZILLA_LIBS" >&5
 echo $ECHO_N "checking MOZILLA_LIBS... $ECHO_C" >&6
-            MOZILLA_LIBS=`$PKG_CONFIG --libs "seamonkey-plugin seamonkey-xpcom"`
+            MOZILLA_LIBS=`$PKG_CONFIG --libs  "seamonkey-plugin seamonkey-xpcom"`
             echo "$as_me:$LINENO: result: $MOZILLA_LIBS" >&5
 echo "${ECHO_T}$MOZILLA_LIBS" >&6
         else
@@ -23403,13 +23501,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking MOZILLA_CFLAGS" >&5
 echo $ECHO_N "checking MOZILLA_CFLAGS... $ECHO_C" >&6
-            MOZILLA_CFLAGS=`$PKG_CONFIG --cflags "iceape-plugin iceape-xpcom"`
+            MOZILLA_CFLAGS=`$PKG_CONFIG --cflags  "iceape-plugin iceape-xpcom"`
             echo "$as_me:$LINENO: result: $MOZILLA_CFLAGS" >&5
 echo "${ECHO_T}$MOZILLA_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking MOZILLA_LIBS" >&5
 echo $ECHO_N "checking MOZILLA_LIBS... $ECHO_C" >&6
-            MOZILLA_LIBS=`$PKG_CONFIG --libs "iceape-plugin iceape-xpcom"`
+            MOZILLA_LIBS=`$PKG_CONFIG --libs  "iceape-plugin iceape-xpcom"`
             echo "$as_me:$LINENO: result: $MOZILLA_LIBS" >&5
 echo "${ECHO_T}$MOZILLA_LIBS" >&6
         else
@@ -23506,13 +23604,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking GLIB_CFLAGS" >&5
 echo $ECHO_N "checking GLIB_CFLAGS... $ECHO_C" >&6
-            GLIB_CFLAGS=`$PKG_CONFIG --cflags "glib-2.0"`
+            GLIB_CFLAGS=`$PKG_CONFIG --cflags  "glib-2.0"`
             echo "$as_me:$LINENO: result: $GLIB_CFLAGS" >&5
 echo "${ECHO_T}$GLIB_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking GLIB_LIBS" >&5
 echo $ECHO_N "checking GLIB_LIBS... $ECHO_C" >&6
-            GLIB_LIBS=`$PKG_CONFIG --libs "glib-2.0"`
+            GLIB_LIBS=`$PKG_CONFIG --libs  "glib-2.0"`
             echo "$as_me:$LINENO: result: $GLIB_LIBS" >&5
 echo "${ECHO_T}$GLIB_LIBS" >&6
         else
@@ -23604,13 +23702,13 @@ echo "${ECHO_T}yes" >&6
 
             echo "$as_me:$LINENO: checking GTK_CFLAGS" >&5
 echo $ECHO_N "checking GTK_CFLAGS... $ECHO_C" >&6
-            GTK_CFLAGS=`$PKG_CONFIG --cflags "gtk+-2.0 >= 2.8 gthread-2.0 >= 2.2 gdk-pixbuf-2.0"`
+            GTK_CFLAGS=`$PKG_CONFIG --cflags  "gtk+-2.0 >= 2.8 gthread-2.0 >= 2.2 gdk-pixbuf-2.0"`
             echo "$as_me:$LINENO: result: $GTK_CFLAGS" >&5
 echo "${ECHO_T}$GTK_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking GTK_LIBS" >&5
 echo $ECHO_N "checking GTK_LIBS... $ECHO_C" >&6
-            GTK_LIBS=`$PKG_CONFIG --libs "gtk+-2.0 >= 2.8 gthread-2.0 >= 2.2 gdk-pixbuf-2.0"`
+            GTK_LIBS=`$PKG_CONFIG --libs  "gtk+-2.0 >= 2.8 gthread-2.0 >= 2.2 gdk-pixbuf-2.0"`
             echo "$as_me:$LINENO: result: $GTK_LIBS" >&5
 echo "${ECHO_T}$GTK_LIBS" >&6
         else
--- libjava/classpath/m4/pkg.m4.jj	2006-10-05 00:29:54.000000000 +0200
+++ libjava/classpath/m4/pkg.m4	2007-12-20 23:38:46.000000000 +0100
@@ -1,5 +1,5 @@
 
-dnl PKG_CHECK_MODULES(GSTUFF, gtk+-2.0 >= 1.3 glib = 1.3.4, action-if, action-not)
+dnl PKG_CHECK_MODULES(GSTUFF, gtk+-2.0 >= 1.3 glib = 1.3.4, , action-if, action-not)
 dnl defines GSTUFF_LIBS, GSTUFF_CFLAGS, see pkg-config man page
 dnl also defines GSTUFF_PKG_ERRORS on error
 AC_DEFUN([PKG_CHECK_MODULES], [
@@ -24,11 +24,11 @@ AC_DEFUN([PKG_CHECK_MODULES], [
             succeeded=yes
 
             AC_MSG_CHECKING($1_CFLAGS)
-            $1_CFLAGS=`$PKG_CONFIG --cflags "$2"`
+            $1_CFLAGS=`$PKG_CONFIG --cflags $3 "$2"`
             AC_MSG_RESULT($$1_CFLAGS)
 
             AC_MSG_CHECKING($1_LIBS)
-            $1_LIBS=`$PKG_CONFIG --libs "$2"`
+            $1_LIBS=`$PKG_CONFIG --libs $3 "$2"`
             AC_MSG_RESULT($$1_LIBS)
         else
             $1_CFLAGS=""
@@ -36,7 +36,7 @@ AC_DEFUN([PKG_CHECK_MODULES], [
             ## If we have a custom action on failure, don't print errors, but 
             ## do set a variable so people can do so.
             $1_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "$2"`
-            ifelse([$4], ,echo $$1_PKG_ERRORS,)
+            ifelse([$5], ,echo $$1_PKG_ERRORS,)
         fi
 
         AC_SUBST($1_CFLAGS)
@@ -48,9 +48,9 @@ AC_DEFUN([PKG_CHECK_MODULES], [
   fi
 
   if test $succeeded = yes; then
-     ifelse([$3], , :, [$3])
+     ifelse([$4], , :, [$4])
   else
-     ifelse([$4], , AC_MSG_ERROR([Library requirements ($2) not met; consider adjusting the PKG_CONFIG_PATH environment variable if your libraries are in a nonstandard prefix so pkg-config can find them.]), [$4])
+     ifelse([$5], , AC_MSG_ERROR([Library requirements ($2) not met; consider adjusting the PKG_CONFIG_PATH environment variable if your libraries are in a nonstandard prefix so pkg-config can find them.]), [$5])
   fi
 ])
 
